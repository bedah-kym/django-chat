{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trial Applications</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Trial Applications</h2>
        <a class="btn btn-outline-secondary" href="{% url 'users:dashboard' %}">Back to dashboard</a>
    </div>

    <div class="table-responsive mb-4">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Use case</th>
                    <th>Team</th>
                    <th>When</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td>{{ app.name }}</td>
                    <td>{{ app.email }}</td>
                    <td style="max-width:240px;">{{ app.primary_use_case|truncatewords:18 }}</td>
                    <td>{{ app.team_size }} | {{ app.industry }}</td>
                    <td>{{ app.created_at|naturaltime }}</td>
                    <td class="text-capitalize">{{ app.status }}</td>
                    <td>
                        {% if user.is_superuser %}
                        <a class="btn btn-sm btn-primary" href="{% url 'users:send_trial_invite' app.id %}">Send invite</a>
                        {% else %}
                        <span class="text-muted">Superuser only</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="7" class="text-center text-muted py-3">No applications yet.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h4>Invites</h4>
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Sent</th>
                    <th>Activated</th>
                    <th>Ends</th>
                    <th>By</th>
                </tr>
            </thead>
            <tbody>
                {% for inv in invites %}
                <tr>
                    <td>{{ inv.email }}</td>
                    <td class="text-capitalize">{{ inv.status }}</td>
                    <td>{{ inv.sent_at|naturaltime }}</td>
                    <td>{{ inv.activated_at|naturaltime }}</td>
                    <td>{% if inv.trial_ends_at %}{{ inv.trial_ends_at|date:"Y-m-d" }}{% endif %}</td>
                    <td>{{ inv.sent_by }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="6" class="text-center text-muted py-3">No invites yet.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
