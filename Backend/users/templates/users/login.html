{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>KwikChat — Sign in</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Inter font (shadcn default) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    // Tailwind config for shadcn-like design system
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            border: 'hsl(var(--border))',
            input: 'hsl(var(--input))',
            ring: 'hsl(var(--ring))',
            background: 'hsl(var(--background))',
            foreground: 'hsl(var(--foreground))',
            primary: {
              DEFAULT: 'hsl(var(--primary))',
              foreground: 'hsl(var(--primary-foreground))',
            },
            secondary: {
              DEFAULT: 'hsl(var(--secondary))',
              foreground: 'hsl(var(--secondary-foreground))',
            },
            muted: {
              DEFAULT: 'hsl(var(--muted))',
              foreground: 'hsl(var(--muted-foreground))',
            },
            accent: {
              DEFAULT: 'hsl(var(--accent))',
              foreground: 'hsl(var(--accent-foreground))',
            },
            destructive: {
              DEFAULT: 'hsl(var(--destructive))',
              foreground: 'hsl(var(--destructive-foreground))',
            },
            card: {
              DEFAULT: 'hsl(var(--card))',
              foreground: 'hsl(var(--card-foreground))',
            },
          },
          borderRadius: {
            lg: 'var(--radius)',
            md: 'calc(var(--radius) - 2px)',
            sm: 'calc(var(--radius) - 4px)',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      },
    }
  </script>

  <style>
    /* Shadcn UI Color System */
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --primary: 222.2 47.4% 11.2%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 222.2 84% 4.9%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --primary: 210 40% 98%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 212.7 26.8% 83.9%;
    }

    * {
      border-color: hsl(var(--border));
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
    }

    /* Custom smooth transitions */
    .theme-transition {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
  </style>
</head>

<body class="bg-background text-foreground theme-transition min-h-screen">

  <!-- Theme Toggle Button (Fixed top-right) -->
  <button id="themeToggle"
    class="fixed top-4 right-4 z-50 p-2.5 rounded-md bg-card border border-border hover:bg-accent transition-colors"
    aria-label="Toggle theme">
    <i class="fas fa-moon dark:hidden text-foreground"></i>
    <i class="fas fa-sun hidden dark:inline text-foreground"></i>
  </button>

  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-5xl">
      <div class="grid lg:grid-cols-2 gap-8 items-center">

        <!-- Left Column - Branding & Info -->
        <div class="hidden lg:flex flex-col justify-center space-y-6 pr-8">
          <div class="space-y-4">
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 rounded-lg bg-primary flex items-center justify-center">
                <i class="fas fa-bolt text-primary-foreground text-xl"></i>
              </div>
              <h1 class="text-3xl font-bold tracking-tight">KwikChat</h1>
            </div>
            <p class="text-xl text-muted-foreground leading-relaxed">
              Fast, secure, and intelligent messaging for modern teams.
            </p>
          </div>

          <div class="space-y-4 pt-6">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-md bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
                <i class="fas fa-shield-alt text-sm text-muted-foreground"></i>
              </div>
              <div>
                <h3 class="font-semibold text-sm mb-1">Enterprise Security</h3>
                <p class="text-sm text-muted-foreground">End-to-end encryption for all your conversations</p>
              </div>
            </div>

            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-md bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
                <i class="fas fa-robot text-sm text-muted-foreground"></i>
              </div>
              <div>
                <h3 class="font-semibold text-sm mb-1">AI-Powered Assistant</h3>
                <p class="text-sm text-muted-foreground">Smart replies and contextual suggestions</p>
              </div>
            </div>

            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-md bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
                <i class="fas fa-bolt text-sm text-muted-foreground"></i>
              </div>
              <div>
                <h3 class="font-semibold text-sm mb-1">Lightning Fast</h3>
                <p class="text-sm text-muted-foreground">Real-time messaging with zero lag</p>
              </div>
            </div>
          </div>

          <div class="pt-6 border-t border-border">
            <p class="text-sm text-muted-foreground">
              "This platform has transformed how our team communicates. It's fast, intuitive, and just works."
            </p>
            <div class="flex items-center space-x-2 mt-3">
              <div class="w-8 h-8 rounded-full bg-muted"></div>
              <div class="text-sm">
                <p class="font-medium">Sarah Johnson</p>
                <p class="text-muted-foreground text-xs">Product Manager, TechCorp</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Login Form -->
        <div class="w-full">
          <div class="bg-card border border-border rounded-lg p-8 shadow-sm theme-transition">
            <div class="mb-8">
              <h2 class="text-2xl font-semibold tracking-tight mb-2">Welcome back</h2>
              <p class="text-sm text-muted-foreground">
                Enter your credentials to sign in to your account
              </p>
            </div>

            <!-- Error Messages -->
            {% if form.errors %}
            <div class="mb-6 p-4 rounded-md bg-destructive/10 border border-destructive/20" role="alert">
              <div class="flex items-center space-x-2">
                <i class="fas fa-exclamation-circle text-destructive text-sm"></i>
                <p class="text-sm text-destructive font-medium">Invalid username or password. Please try again.</p>
              </div>
            </div>
            {% endif %}

            {% if messages %}
            {% for message in messages %}
            <div class="mb-6 p-4 rounded-md bg-primary/10 border border-primary/20" role="status">
              <div class="flex items-center space-x-2">
                <i class="fas fa-info-circle text-primary text-sm"></i>
                <p class="text-sm text-primary font-medium">{{ message }}</p>
              </div>
            </div>
            {% endfor %}
            {% endif %}

            <form method="post" id="loginForm" novalidate class="space-y-6">
              {% csrf_token %}

              <!-- Username -->
              <div class="space-y-2">
                <label for="username" class="text-sm font-medium block">
                  Username
                </label>
                <div class="relative">
                  <input type="text" name="username" id="username"
                    class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background transition-all theme-transition"
                    placeholder="Enter your username" required minlength="3" autocomplete="username">
                </div>
              </div>

              <!-- Password -->
              <div class="space-y-2">
                <div class="flex items-center justify-between">
                  <label for="password" class="text-sm font-medium block">
                    Password
                  </label>
                  <a href="#" class="text-sm text-primary hover:underline">
                    Forgot password?
                  </a>
                </div>
                <div class="relative">
                  <input type="password" name="password" id="password"
                    class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background transition-all theme-transition pr-10"
                    placeholder="Enter your password" required minlength="8" autocomplete="current-password">
                  <button type="button" id="togglePassword"
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                    aria-label="Toggle password visibility">
                    <i class="fas fa-eye text-sm"></i>
                  </button>
                </div>
              </div>

              <!-- Remember Me -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="remember" id="remember"
                  class="w-4 h-4 rounded border-input text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background cursor-pointer">
                <label for="remember" class="text-sm text-muted-foreground cursor-pointer select-none">
                  Remember me for 30 days
                </label>
              </div>

              <!-- Submit Button -->
              <button type="submit" id="submitBtn"
                class="w-full py-2.5 px-4 bg-primary text-primary-foreground rounded-md text-sm font-medium hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                <span id="btnSpinner" class="hidden">
                  <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                  </svg>
                </span>
                <span id="btnText">
                  <i class="fas fa-sign-in-alt mr-2"></i>Sign in
                </span>
              </button>

              <!-- Divider -->
              <div class="relative my-6">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-border"></div>
                </div>
                <div class="relative flex justify-center text-xs uppercase">
                  <span class="bg-card px-2 text-muted-foreground">Or continue with</span>
                </div>
              </div>

              {% load socialaccount %}
              <!-- Social Login -->
              <div class="grid grid-cols-2 gap-4">
                <a href="{% provider_login_url 'google' %}"
                  class="py-2.5 px-4 border border-input bg-background hover:bg-accent hover:text-accent-foreground rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2">
                  <i class="fab fa-google"></i>
                  <span>Google</span>
                </a>
                <a href="{% provider_login_url 'github' %}"
                  class="py-2.5 px-4 border border-input bg-background hover:bg-accent hover:text-accent-foreground rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2">
                  <i class="fab fa-github"></i>
                  <span>GitHub</span>
                </a>
                <a href="{% provider_login_url 'linkedin_oauth2' %}"
                  class="py-2.5 px-4 border border-input bg-background hover:bg-accent hover:text-accent-foreground rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2">
                  <i class="fab fa-linkedin"></i>
                  <span>LinkedIn</span>
                </a>
                <a href="{% provider_login_url 'twitter' %}"
                  class="py-2.5 px-4 border border-input bg-background hover:bg-accent hover:text-accent-foreground rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2">
                  <i class="fab fa-twitter"></i>
                  <span>Twitter</span>
                </a>
              </div>
            </form>

            <!-- Footer -->
            <div class="mt-8 pt-6 border-t border-border text-center">
              <p class="text-sm text-muted-foreground">
                Don't have an account?
                <a href="{% url 'users:register' %}" class="text-primary hover:underline font-medium">Sign up</a>
              </p>
            </div>
          </div>

          <!-- Mobile branding (shown only on small screens) -->
          <div class="lg:hidden mt-8 text-center">
            <p class="text-xs text-muted-foreground">
              © 2025 KwikChat. All rights reserved.
            </p>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ========================================
    // Theme Toggle with localStorage persistence
    // ========================================
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;

    // Load theme from localStorage or default to dark
    const currentTheme = localStorage.getItem('theme') || 'dark';
    html.classList.toggle('dark', currentTheme === 'dark');

    themeToggle.addEventListener('click', () => {
      const isDark = html.classList.contains('dark');
      html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    });

    // ========================================
    // Form handling
    // ========================================
    const form = document.getElementById('loginForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    const inputs = form.querySelectorAll('input[required]');
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    // Password visibility toggle
    togglePassword.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      const icon = togglePassword.querySelector('i');
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });

    // Input validation
    function validateInput(input) {
      const isValid = input.checkValidity();
      if (!isValid) {
        input.classList.add('border-destructive');
        input.classList.remove('border-input');
      } else {
        input.classList.remove('border-destructive');
        input.classList.add('border-input');
      }
      return isValid;
    }

    inputs.forEach(input => {
      input.addEventListener('blur', () => validateInput(input));
      input.addEventListener('input', () => {
        if (input.classList.contains('border-destructive')) {
          validateInput(input);
        }
      });
    });

    // Form submission
    form.addEventListener('submit', (e) => {
      let isValid = true;

      inputs.forEach(input => {
        if (!validateInput(input)) {
          isValid = false;
        }
      });

      if (!isValid) {
        e.preventDefault();
        const firstError = form.querySelector('.border-destructive');
        if (firstError) firstError.focus();
        return;
      }

      // Show loading state
      submitBtn.disabled = true;
      btnText.classList.add('hidden');
      btnSpinner.classList.remove('hidden');
    });

    // Restore state on back/refresh
    window.addEventListener('pageshow', (event) => {
      if (event.persisted) {
        submitBtn.disabled = false;
        btnText.classList.remove('hidden');
        btnSpinner.classList.add('hidden');
        inputs.forEach(input => {
          input.classList.remove('border-destructive');
          input.classList.add('border-input');
        });
      }
    });
  </script>
</body>

</html>
